Extract data from A09 and A20
================

``` r
library(rvest)

dir.create(here::here("data", "attrs"), recursive = TRUE, showWarnings = FALSE)
```

### `A09`

``` r
input <- here::here("data-raw", "datalist", "KsjTmplt-A09.html")
id <- stringr::str_replace(basename(input), "(?:KsjTmplt-)(.*?)(?:-v.*)?(?:\\.html)", "\\1")
output <- here::here("data", "attrs", glue::glue("{id}.csv"))

attr_table <- read_html(input) %>% 
  html_table(convert = FALSE) %>% 
  purrr::keep(~ .x[1, 1] == "地物情報")

stopifnot(length(attr_table) == 1)
```

属性情報が2種類ある

``` r
attr_table[[1]]$X1
```

    ##  [1] "地物情報"                                
    ##  [2] "地物情報"                                
    ##  [3] "属性情報（平成18年度、平成23年度）"      
    ##  [4] "属性情報（平成18年度、平成23年度）"      
    ##  [5] "属性情報（平成18年度、平成23年度）"      
    ##  [6] "属性情報（平成18年度、平成23年度）"      
    ##  [7] "属性情報（平成18年度、平成23年度）"      
    ##  [8] "属性情報（平成30年度）"                  
    ##  [9] "属性情報（平成30年度）"                  
    ## [10] "属性情報（平成30年度）"                  
    ## [11] "属性情報（平成30年度）"                  
    ## [12] "属性情報（平成30年度）"                  
    ## [13] "主な品質情報"                            
    ## [14] "データフォーマット（符号化）"            
    ## [15] "国土情報ウェブマッピングシステムへの登録"
    ## [16] "備考"                                    
    ## [17] "識別子"                                  
    ## [18] "その他の情報"

一般的な情報しかなさそうなので省略

``` r
attr_table[[1]][startsWith(attr_table[[1]]$X1, "属性情報"), ] %>% 
  knitr::kable()
```

| X1                                 | X2                 | X3                                           | X4                                 |
|:-----------------------------------|:-------------------|:---------------------------------------------|:-----------------------------------|
| 属性情報（平成18年度、平成23年度） | 属性名             | 説明                                         | 属性の型                           |
| 属性情報（平成18年度、平成23年度） | 範囲               | 都市地域として定義された領域。               | 曲面型（GM\_Surface）              |
| 属性情報（平成18年度、平成23年度） | 都道府県コード     | 都道府県を一意に識別するために付された番号。 | コードリスト「都道府県コード」     |
| 属性情報（平成18年度、平成23年度） | 支庁区分コード     | 支庁区域を一意に識別するために付された番号。 | コードリスト「支庁区分コード」     |
| 属性情報（平成18年度、平成23年度） | 都市地域区分コード | 都市地域を一意に識別するために付された番号。 | コードリスト「都市地域区分コード」 |
| 属性情報（平成30年度）             | 属性名             | 説明                                         | 属性の型                           |
| 属性情報（平成30年度）             | 範囲               | 都市地域として定義された領域。               | 曲面型（GM\_Surface）              |
| 属性情報（平成30年度）             | 都道府県コード     | 都道府県を一意に識別するために付された番号。 | コードリスト「都道府県コード」     |
| 属性情報（平成30年度）             | 市区町村コード     | 市区町村を一意に識別するために付された番号。 | コードリスト「市区町村コード」     |
| 属性情報（平成30年度）             | 都市地域区分コード | 都市地域を一意に識別するために付された番号。 | コードリスト「都市地域区分コード」 |

### `A20`

``` r
input <- here::here("data-raw", "datalist", "KsjTmplt-A20.html")
id <- stringr::str_replace(basename(input), "(?:KsjTmplt-)(.*?)(?:-v.*)?(?:\\.html)", "\\1")
output <- here::here("data", "attrs", glue::glue("{id}.csv"))

attr_table <- read_html(input) %>% 
  html_table(convert = FALSE) %>% 
  purrr::keep(~ !is.na(.x[1, 1]) && .x[1, 1] == "地物情報")

stopifnot(length(attr_table) == 1)
```

``` r
attr_table[[1]]$X1
```

    ##  [1] "地物情報"                                
    ##  [2] "地物情報"                                
    ##  [3] "属性情報"                                
    ##  [4] "属性情報"                                
    ##  [5] "属性情報"                                
    ##  [6] "属性情報"                                
    ##  [7] "主な品質情報"                            
    ##  [8] "データフォーマット（符号化）"            
    ##  [9] "国土情報ウェブマッピングシステムへの登録"
    ## [10] "識別子"                                  
    ## [11] "その他の情報"

一般的な情報しかなさそうなので省略

``` r
attr_table[[1]][startsWith(attr_table[[1]]$X1, "属性情報"), ] %>% 
  knitr::kable()
```

| X1       | X2             | X3                                           | X4                             |
|:---------|:---------------|:---------------------------------------------|:-------------------------------|
| 属性情報 | 属性名         | 説明                                         | 属性の型                       |
| 属性情報 | 範囲           | 奄美群島として定義された領域。               | 曲面型（GM\_Surface）          |
| 属性情報 | 都道府県コード | 都道府県を一意に識別するために付された番号。 | コードリスト「都道府県コード」 |
| 属性情報 | 支庁区分コード | 支庁区域を一意に識別するために付された番号。 | コードリスト「支庁区分コード」 |
