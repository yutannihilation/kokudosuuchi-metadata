Extract data from N08
================

``` r
library(rvest)
library(dplyr, warn.conflicts = FALSE)

dir.create(here::here("data", "attrs"), recursive = TRUE, showWarnings = FALSE)
```

### `N08`

これは単純に5列目を取り除けばよさそう

``` r
input <- here::here("data-raw", "datalist", "KsjTmplt-N08-v1_4.html")
id <- stringr::str_replace(basename(input), "(?:KsjTmplt-)(.*?)(?:-v.*)?(?:\\.html)", "\\1")
output <- here::here("data", "attrs", glue::glue("{id}.csv"))

attr_table <- read_html(input) %>% 
  html_table(convert = FALSE) %>% 
  purrr::keep(~ "地物情報" %in% colnames(.x))

stopifnot(length(attr_table) == 1)
attr_table <- attr_table[[1]]

knitr::kable(attr_table)
```

| 地物情報                                 | 地物名                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                |      |
|:-----------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----|
| 地物情報                                 | 空港区域                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 公共用空港・飛行場                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 公共用空港・飛行場                                                                                                                                                                                                                                                                                                                                                                                                                                                  | NA   |
| 属性情報                                 | 属性名（かっこ内はshp属性名）                                                                                                                                                                                                                                                                                                                                                                                                                                       | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 属性の型                                                                                                                                                                                                                                                                                                                                                                                                                                                            | NA   |
| 属性情報                                 | 空港区域                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 空港区域の位置                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 曲面型（GM\_Surface）                                                                                                                                                                                                                                                                                                                                                                                                                                               | NA   |
| 属性情報                                 | 行政区域（N08\_001）                                                                                                                                                                                                                                                                                                                                                                                                                                                | 空港区域のある市区町村の行政コード                                                                                                                                                                                                                                                                                                                                                                                                                                  | コードリスト「行政コード」                                                                                                                                                                                                                                                                                                                                                                                                                                          | NA   |
| 属性情報                                 | 空港種別（N08\_002）                                                                                                                                                                                                                                                                                                                                                                                                                                                | 空港の種類による区別                                                                                                                                                                                                                                                                                                                                                                                                                                                | コードリスト「空港種別コード」                                                                                                                                                                                                                                                                                                                                                                                                                                      | NA   |
| 属性情報                                 | 空港名称（N08\_003）                                                                                                                                                                                                                                                                                                                                                                                                                                                | 空港の名称                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 文字列型（CharacterString）                                                                                                                                                                                                                                                                                                                                                                                                                                         | NA   |
| 属性情報                                 | 設置者（N08\_004）                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 空港を設立した組織                                                                                                                                                                                                                                                                                                                                                                                                                                                  | コードリスト「設置者・管理者コード」                                                                                                                                                                                                                                                                                                                                                                                                                                | NA   |
| 属性情報                                 | 管理者（N08\_005）                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 空港を管理している組織                                                                                                                                                                                                                                                                                                                                                                                                                                              | コードリスト「設置者・管理者コード」                                                                                                                                                                                                                                                                                                                                                                                                                                | NA   |
| 属性情報                                 | 滑走路本数（N08\_006）                                                                                                                                                                                                                                                                                                                                                                                                                                              | 当該空港に存在する滑走路の本数                                                                                                                                                                                                                                                                                                                                                                                                                                      | 整数型（Integer）                                                                                                                                                                                                                                                                                                                                                                                                                                                   | NA   |
| 属性情報                                 | 滑走路延長（N08\_007）                                                                                                                                                                                                                                                                                                                                                                                                                                              | 滑走路の延長の内、最も長い滑走路の長さ（ｍ）                                                                                                                                                                                                                                                                                                                                                                                                                        | 整数型（Integer）                                                                                                                                                                                                                                                                                                                                                                                                                                                   | NA   |
| 属性情報                                 | 運用時間（開始）（N08\_008）                                                                                                                                                                                                                                                                                                                                                                                                                                        | 1日のうちで空港の運用を開始する時刻                                                                                                                                                                                                                                                                                                                                                                                                                                 | 順序型（整数型の配列）記述例）　07 30　（7時30分の場合）00 00　（0時0分の場合）※運用時間が24時間の場合、開始時間は「00 00」とする。※供用開始前の空港は「00 00」とする※不明な場合は「99 99」とする。                                                                                                                                                                                                                                                                 | NA   |
| 属性情報                                 | 運用時間（終了）（N08\_009）                                                                                                                                                                                                                                                                                                                                                                                                                                        | 1日のうちで、空港の運用を終了する時刻                                                                                                                                                                                                                                                                                                                                                                                                                               | 順序型（整数型の配列）記述例）　21 30　（21時30分の場合）24 00　（24時0分の場合）※運用時間が24時間の場合、終了時間は「24 00」とする。※供用開始前の空港は「00 00」とする※不明な場合は「99 99」とする。                                                                                                                                                                                                                                                               | NA   |
| 属性情報                                 | 定期便（N08\_010）                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 定期便の有無                                                                                                                                                                                                                                                                                                                                                                                                                                                        | コードリスト「定期便コード」                                                                                                                                                                                                                                                                                                                                                                                                                                        | NA   |
| 属性情報                                 | ジェット化（N08\_011）                                                                                                                                                                                                                                                                                                                                                                                                                                              | 空港のジェット化の状況                                                                                                                                                                                                                                                                                                                                                                                                                                              | コードリスト「ジェット化コード」                                                                                                                                                                                                                                                                                                                                                                                                                                    | NA   |
| 属性情報                                 | 供用開始年（N08\_012）                                                                                                                                                                                                                                                                                                                                                                                                                                              | 空港が最初に供用された年（西暦）                                                                                                                                                                                                                                                                                                                                                                                                                                    | 時間型（TM\_Instant）                                                                                                                                                                                                                                                                                                                                                                                                                                               | NA   |
| 属性情報                                 | 供用状況（N08\_013）                                                                                                                                                                                                                                                                                                                                                                                                                                                | 標点が供用されている状況                                                                                                                                                                                                                                                                                                                                                                                                                                            | コードリスト「供用状況コード」                                                                                                                                                                                                                                                                                                                                                                                                                                      | NA   |
| 属性情報                                 | 設置期間（開始年）（N08\_014）                                                                                                                                                                                                                                                                                                                                                                                                                                      | 該当する空港が設置開始（開業）された年                                                                                                                                                                                                                                                                                                                                                                                                                              | 時間型（TM\_Instant）                                                                                                                                                                                                                                                                                                                                                                                                                                               | NA   |
| 属性情報                                 | 設置期間（終了年）（N08\_015）                                                                                                                                                                                                                                                                                                                                                                                                                                      | 該当する空港が廃止（変更・廃止）された年の1年前の年地物が継続中の場合は9999                                                                                                                                                                                                                                                                                                                                                                                         | 時間型（TM\_Instant）                                                                                                                                                                                                                                                                                                                                                                                                                                               | NA   |
| 属性情報                                 | 関係ID（N08\_016）                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 空港区域の属性が変更された場合の同一地物の時系列変化データであることを表すグループID（その他の情報欄に詳細を説明）                                                                                                                                                                                                                                                                                                                                                  | 文字列型（CharacterString）                                                                                                                                                                                                                                                                                                                                                                                                                                         | NA   |
| 属性情報                                 | 変遷ID（N08\_017）                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 同一年次に複数回属性が変更された場合の属性項目を表す識別子                                                                                                                                                                                                                                                                                                                                                                                                          | コードリスト「変遷IDコード」                                                                                                                                                                                                                                                                                                                                                                                                                                        | NA   |
| 属性情報                                 | 変遷備考（N08\_018）                                                                                                                                                                                                                                                                                                                                                                                                                                                | 変遷IDで示した属性の内容を記述する                                                                                                                                                                                                                                                                                                                                                                                                                                  | 文字列型（CharacterString）                                                                                                                                                                                                                                                                                                                                                                                                                                         | NA   |
| 属性情報                                 | 地物情報                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 地物名                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 説明 |
| 標点                                     | 地物情報                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 着陸帯の幾何学中心（滑走路が２以上ある場合は、それぞれの重心から計算して得られる１個の重心）                                                                                                                                                                                                                                                                                                                                                                        | 着陸帯の幾何学中心（滑走路が２以上ある場合は、それぞれの重心から計算して得られる１個の重心）                                                                                                                                                                                                                                                                                                                                                                        | NA   |
| 属性情報                                 | 属性名                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 属性の型                                                                                                                                                                                                                                                                                                                                                                                                                                                            | NA   |
| 属性情報                                 | 地点                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 地点の位置                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 点型（GM\_Point）                                                                                                                                                                                                                                                                                                                                                                                                                                                   | NA   |
| 属性情報                                 | 空港名称（N08\_019）                                                                                                                                                                                                                                                                                                                                                                                                                                                | 標点が属する空港の名称                                                                                                                                                                                                                                                                                                                                                                                                                                              | 文字列型（CharacterString）                                                                                                                                                                                                                                                                                                                                                                                                                                         | NA   |
| 属性情報                                 | 供用開始年（N08\_020）                                                                                                                                                                                                                                                                                                                                                                                                                                              | 標点の供用が開始された年                                                                                                                                                                                                                                                                                                                                                                                                                                            | 時間型（TM\_Instant）                                                                                                                                                                                                                                                                                                                                                                                                                                               | NA   |
| 属性情報                                 | 供用状況（N08\_021）                                                                                                                                                                                                                                                                                                                                                                                                                                                | 標点が供用されている状況                                                                                                                                                                                                                                                                                                                                                                                                                                            | コードリスト「供用状況コード」                                                                                                                                                                                                                                                                                                                                                                                                                                      | NA   |
| 属性情報                                 | 設置期間（開始年）（N08\_022）                                                                                                                                                                                                                                                                                                                                                                                                                                      | 標点が設置開始（開業）された年                                                                                                                                                                                                                                                                                                                                                                                                                                      | 時間型（TM\_Instant）                                                                                                                                                                                                                                                                                                                                                                                                                                               | NA   |
| 属性情報                                 | 設置期間（終了年）（N08\_023）                                                                                                                                                                                                                                                                                                                                                                                                                                      | 標点が廃止（変更・廃止）された年の1年前の年地物が継続中の場合は9999                                                                                                                                                                                                                                                                                                                                                                                                 | 時間型（TM\_Instant）                                                                                                                                                                                                                                                                                                                                                                                                                                               | NA   |
| 属性情報                                 | 関係ID（N08\_024）                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 標点について、同一地物の時系列変化であることを示すID（その他の情報欄に詳細を説明）                                                                                                                                                                                                                                                                                                                                                                                  | 文字列型（CharacterString）                                                                                                                                                                                                                                                                                                                                                                                                                                         | NA   |
| 属性情報                                 | 備考（N08\_025）                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 官報に記載された緯度経度情報をもとに作成した標点が、当該空港区域内にプロットされず標点位置を移動した際に記載する。                                                                                                                                                                                                                                                                                                                                                  | 文字列型（CharacterString）記述例）「標点位置は官報の座標（北緯XX°YY′ZZ″、東経XX°YY′ZZ″）から、現在の位置に移動した。」                                                                                                                                                                                                                                                                                                                                             | NA   |
| 主な品質情報                             | ■完全性/過剰・漏れ：　全数検査、誤率0%製品仕様書にある空港一覧と比較。■ 位置正確度/絶対正確度（外部正確度）：　全数検査、誤率0%収集した資料と比較。■ 分類正確度/非定量的属性の正しさ各属性に対して、収集した資料の情報が付与されているかを比較。                                                                                                                                                                                                                    | ■完全性/過剰・漏れ：　全数検査、誤率0%製品仕様書にある空港一覧と比較。■ 位置正確度/絶対正確度（外部正確度）：　全数検査、誤率0%収集した資料と比較。■ 分類正確度/非定量的属性の正しさ各属性に対して、収集した資料の情報が付与されているかを比較。                                                                                                                                                                                                                    | ■完全性/過剰・漏れ：　全数検査、誤率0%製品仕様書にある空港一覧と比較。■ 位置正確度/絶対正確度（外部正確度）：　全数検査、誤率0%収集した資料と比較。■ 分類正確度/非定量的属性の正しさ各属性に対して、収集した資料の情報が付与されているかを比較。                                                                                                                                                                                                                    | NA   |
| データフォーマット（符号化）             | ・GML形式（JPGIS2.1準拠）。詳細は製品仕様書内の符号化規則を参照してください。・GeoJSON形式（平成28年度から）・シェープファイル形式。シェープファイルの属性について                                                                                                                                                                                                                                                                                                  | ・GML形式（JPGIS2.1準拠）。詳細は製品仕様書内の符号化規則を参照してください。・GeoJSON形式（平成28年度から）・シェープファイル形式。シェープファイルの属性について                                                                                                                                                                                                                                                                                                  | ・GML形式（JPGIS2.1準拠）。詳細は製品仕様書内の符号化規則を参照してください。・GeoJSON形式（平成28年度から）・シェープファイル形式。シェープファイルの属性について                                                                                                                                                                                                                                                                                                  | NA   |
| 国土情報ウェブマッピングシステムへの登録 | 調整中                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 調整中                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 調整中                                                                                                                                                                                                                                                                                                                                                                                                                                                              | NA   |
| 識別子                                   | N08                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | N08                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | N08                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | NA   |
| その他の情報                             | 各データのメタデータについては、ダウンロードしたファイルに添付されています。【関係IDについて】・同一の地物であることを表すグループIDであり、地物間の関係を示す対象地物の種類（地物区分コード）と、 その対象地物に対して、同一と認識される地物全体に順次付与される共通の番号（グルーピングの番号）。・地物区分コードは空港区域をCF02、標点をCF03とし、グルーピングの番号は地物の最も新しいデータを１とする。【時系列データの利用方法について】こちらをご覧ください。 | 各データのメタデータについては、ダウンロードしたファイルに添付されています。【関係IDについて】・同一の地物であることを表すグループIDであり、地物間の関係を示す対象地物の種類（地物区分コード）と、 その対象地物に対して、同一と認識される地物全体に順次付与される共通の番号（グルーピングの番号）。・地物区分コードは空港区域をCF02、標点をCF03とし、グルーピングの番号は地物の最も新しいデータを１とする。【時系列データの利用方法について】こちらをご覧ください。 | 各データのメタデータについては、ダウンロードしたファイルに添付されています。【関係IDについて】・同一の地物であることを表すグループIDであり、地物間の関係を示す対象地物の種類（地物区分コード）と、 その対象地物に対して、同一と認識される地物全体に順次付与される共通の番号（グルーピングの番号）。・地物区分コードは空港区域をCF02、標点をCF03とし、グルーピングの番号は地物の最も新しいデータを１とする。【時系列データの利用方法について】こちらをご覧ください。 | NA   |

``` r
attr_table <- attr_table %>% 
  # 重複を取り除くため
  tibble::as_tibble(.name_repair = "unique") %>% 
  select(-5)
```

    ## New names:
    ## * 説明 -> 説明...3
    ## * 説明 -> 説明...4
    ## * `` -> ...5

``` r
colnames(attr_table) <- c("_", "name", "description", "type")

attr_table <- attr_table %>% 
  filter(
    `_` == "属性情報",
    # テーブルのヘッダは取り除く
    !startsWith(name, "属性名"),
    !startsWith(name, "地物名"),
    type != "説明",
    # 地物は属性情報ではない
    !stringr::str_detect(type, "^(曲面型|曲線型|点型)")
  )

res <- attr_table %>%
  tidyr::extract(name, into = c("name", "code"), regex = "(.*?)(（[A-Za-z0-9]+_[A-Za-z0-9]+）)?$") %>% 
  transmute(
    name,
    code = if_else(code != '', stringr::str_remove_all(code, "[（）]"), NA_character_),
    description,
    type
  )
```

``` r
knitr::kable(res)
```

| name               | code     | description                                                                                                        | type                                                                                                                                                                                                  |
|:-------------------|:---------|:-------------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 行政区域           | N08\_001 | 空港区域のある市区町村の行政コード                                                                                 | コードリスト「行政コード」                                                                                                                                                                            |
| 空港種別           | N08\_002 | 空港の種類による区別                                                                                               | コードリスト「空港種別コード」                                                                                                                                                                        |
| 空港名称           | N08\_003 | 空港の名称                                                                                                         | 文字列型（CharacterString）                                                                                                                                                                           |
| 設置者             | N08\_004 | 空港を設立した組織                                                                                                 | コードリスト「設置者・管理者コード」                                                                                                                                                                  |
| 管理者             | N08\_005 | 空港を管理している組織                                                                                             | コードリスト「設置者・管理者コード」                                                                                                                                                                  |
| 滑走路本数         | N08\_006 | 当該空港に存在する滑走路の本数                                                                                     | 整数型（Integer）                                                                                                                                                                                     |
| 滑走路延長         | N08\_007 | 滑走路の延長の内、最も長い滑走路の長さ（ｍ）                                                                       | 整数型（Integer）                                                                                                                                                                                     |
| 運用時間（開始）   | N08\_008 | 1日のうちで空港の運用を開始する時刻                                                                                | 順序型（整数型の配列）記述例）　07 30　（7時30分の場合）00 00　（0時0分の場合）※運用時間が24時間の場合、開始時間は「00 00」とする。※供用開始前の空港は「00 00」とする※不明な場合は「99 99」とする。   |
| 運用時間（終了）   | N08\_009 | 1日のうちで、空港の運用を終了する時刻                                                                              | 順序型（整数型の配列）記述例）　21 30　（21時30分の場合）24 00　（24時0分の場合）※運用時間が24時間の場合、終了時間は「24 00」とする。※供用開始前の空港は「00 00」とする※不明な場合は「99 99」とする。 |
| 定期便             | N08\_010 | 定期便の有無                                                                                                       | コードリスト「定期便コード」                                                                                                                                                                          |
| ジェット化         | N08\_011 | 空港のジェット化の状況                                                                                             | コードリスト「ジェット化コード」                                                                                                                                                                      |
| 供用開始年         | N08\_012 | 空港が最初に供用された年（西暦）                                                                                   | 時間型（TM\_Instant）                                                                                                                                                                                 |
| 供用状況           | N08\_013 | 標点が供用されている状況                                                                                           | コードリスト「供用状況コード」                                                                                                                                                                        |
| 設置期間（開始年） | N08\_014 | 該当する空港が設置開始（開業）された年                                                                             | 時間型（TM\_Instant）                                                                                                                                                                                 |
| 設置期間（終了年） | N08\_015 | 該当する空港が廃止（変更・廃止）された年の1年前の年地物が継続中の場合は9999                                        | 時間型（TM\_Instant）                                                                                                                                                                                 |
| 関係ID             | N08\_016 | 空港区域の属性が変更された場合の同一地物の時系列変化データであることを表すグループID（その他の情報欄に詳細を説明） | 文字列型（CharacterString）                                                                                                                                                                           |
| 変遷ID             | N08\_017 | 同一年次に複数回属性が変更された場合の属性項目を表す識別子                                                         | コードリスト「変遷IDコード」                                                                                                                                                                          |
| 変遷備考           | N08\_018 | 変遷IDで示した属性の内容を記述する                                                                                 | 文字列型（CharacterString）                                                                                                                                                                           |
| 空港名称           | N08\_019 | 標点が属する空港の名称                                                                                             | 文字列型（CharacterString）                                                                                                                                                                           |
| 供用開始年         | N08\_020 | 標点の供用が開始された年                                                                                           | 時間型（TM\_Instant）                                                                                                                                                                                 |
| 供用状況           | N08\_021 | 標点が供用されている状況                                                                                           | コードリスト「供用状況コード」                                                                                                                                                                        |
| 設置期間（開始年） | N08\_022 | 標点が設置開始（開業）された年                                                                                     | 時間型（TM\_Instant）                                                                                                                                                                                 |
| 設置期間（終了年） | N08\_023 | 標点が廃止（変更・廃止）された年の1年前の年地物が継続中の場合は9999                                                | 時間型（TM\_Instant）                                                                                                                                                                                 |
| 関係ID             | N08\_024 | 標点について、同一地物の時系列変化であることを示すID（その他の情報欄に詳細を説明）                                 | 文字列型（CharacterString）                                                                                                                                                                           |
| 備考               | N08\_025 | 官報に記載された緯度経度情報をもとに作成した標点が、当該空港区域内にプロットされず標点位置を移動した際に記載する。 | 文字列型（CharacterString）記述例）「標点位置は官報の座標（北緯XX°YY′ZZ″、東経XX°YY′ZZ″）から、現在の位置に移動した。」                                                                               |

``` r
readr::write_csv(res, output)
```
