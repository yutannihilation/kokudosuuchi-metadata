Extract data from P22
================

``` r
library(rvest)
library(dplyr, warn.conflicts = FALSE)

dir.create(here::here("data", "attrs"), recursive = TRUE, showWarnings = FALSE)
```

### `P22`

コードが入っている列が2パターンある。 `*`には`a`または`b`が入る。

``` r
input <- here::here("data-raw", "datalist", "KsjTmplt-P22.html")
id <- stringr::str_replace(basename(input), "(?:KsjTmplt-)(.*?)(?:-v.*)?(?:\\.html)", "\\1")
output <- here::here("data", "attrs", glue::glue("{id}.csv"))

attr_table <- read_html(input) %>% 
  html_table(convert = FALSE) %>% 
  purrr::keep(~ "地物情報" %in% colnames(.x))

stopifnot(length(attr_table) == 1)
attr_table <- attr_table[[1]]

knitr::kable(attr_table)
```

| 地物情報                                 | 地物名                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|:-----------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 地物情報                                 | ポンプ場施設（P22a\_）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 下水道法にもとづく、公共下水道、流域下水道、特定公共下水道、特定環境保全公共下水道のポンプ場施設（マンホール形式ポンプ場及び処理場内ポンプ施設を除く）。                                                                                                                                                                                                                                                                                                                                                                                                        | 下水道法にもとづく、公共下水道、流域下水道、特定公共下水道、特定環境保全公共下水道のポンプ場施設（マンホール形式ポンプ場及び処理場内ポンプ施設を除く）。                                                                                                                                                                                                                                                                                                                                                                                                        | 下水道法にもとづく、公共下水道、流域下水道、特定公共下水道、特定環境保全公共下水道のポンプ場施設（マンホール形式ポンプ場及び処理場内ポンプ施設を除く）。                                                                                                                                                                                                                                                                                                                                                                                                        |
| 地物情報                                 | 処理場施設（P22b\_）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 下水道法にもとづく、公共下水道、流域下水道、特定公共下水道、特定環境保全公共下水道の処理場施設。                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 下水道法にもとづく、公共下水道、流域下水道、特定公共下水道、特定環境保全公共下水道の処理場施設。                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 下水道法にもとづく、公共下水道、流域下水道、特定公共下水道、特定環境保全公共下水道の処理場施設。                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 属性情報                                 | 属性名（かっこ内はshp属性名）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 属性の型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 地物共通項目                             | 位置                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 当該施設の位置                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 当該施設の位置                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 点型（GM\_Point）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 地物共通項目                             | 行政区域（P22\*\_001）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 都道府県コードと市区町村コードからなる，行政区を特定するためのコード                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 都道府県コードと市区町村コードからなる，行政区を特定するためのコード                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | コードリスト型（行政区域コード）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 地物共通項目                             | 施設名称（P22\*\_002）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 当該施設の名称                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 当該施設の名称                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 文字列型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 地物共通項目                             | 所在地（P22\*\_003）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 当該施設の所在地。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 当該施設の所在地。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 文字列型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 地物共通項目                             | 市町村等団体名（P22\*\_004）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 当該施設を管理している市町村等団体名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 当該施設を管理している市町村等団体名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 文字列型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 地物共通項目                             | 事業区分名（P22\*\_005）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 当該事業の事業区分名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 当該事業の事業区分名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 列挙型（事業区分名詳細）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 地物共通項目                             | 事業名（P22\*\_006）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 当該事業の事業名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 当該事業の事業名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 列挙型（事業区分名詳細）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 地物共通項目                             | 全体計画処理面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 当該事業における全体計画の処理面積。単位：ha                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 当該事業における全体計画の処理面積。単位：ha                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 地物共通項目                             | 全体計画処理面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 合計（P22\*\_007）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 全体計画処理面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 汚水（分流）（P22\*\_008）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 全体計画処理面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 雨水（分流）（P22\*\_009）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 全体計画処理面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 合流（P22\*\_010）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 全体計画計画処理人口（P22\*\_011）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 当該事業における全体計画の計画処理人口。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 当該事業における全体計画の計画処理人口。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 整数値                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 全体計画区域内人口（P22\*\_012）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 当該事業における全体計画の計画区域内人口。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 当該事業における全体計画の計画区域内人口。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 整数値                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 雨水計画                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 当該事業における雨水計画。降雨強度（mm/時）、確率年（年）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 当該事業における雨水計画。降雨強度（mm/時）、確率年（年）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 地物共通項目                             | 雨水計画                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 降雨強度最小（P22\*\_013）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 雨水計画                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 降雨強度最大（P22\*\_014）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 雨水計画                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 確率年最小（P22\*\_015）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 雨水計画                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 確率年最大（P22\*\_016）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 汚水計画                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 当該事業における汚水計画。（L/人・日）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 当該事業における汚水計画。（L/人・日）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 地物共通項目                             | 汚水計画                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 1人1日平均汚水最小（P22\*\_017）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 汚水計画                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 1人1日平均汚水最大（P22\*\_018）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 汚水計画                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 1人1日最大汚水最小（P22\*\_019）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 地物共通項目                             | 汚水計画                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 1人1日最大汚水次第（P22\*\_020）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ポンプ場施設                             | 計画排水面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 当該施設の排水対象となる土地の面積。単位：（ha）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 当該施設の排水対象となる土地の面積。単位：（ha）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ポンプ場施設                             | 計画排水面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 汚水（P22a\_021）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ポンプ場施設                             | 計画排水面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 雨水（P22a\_022）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ポンプ場施設                             | 計画排水量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 当該施設の計画排水量。（ｍ3/時）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 当該施設の計画排水量。（ｍ3/時）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ポンプ場施設                             | 計画排水量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 汚水（晴天時最大）（P22a\_023）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ポンプ場施設                             | 計画排水量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 汚水（雨天時最大）（P22a\_024）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ポンプ場施設                             | 計画排水量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 雨水（P22a\_025）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ポンプ場施設                             | 現有排水能力                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 当該施設の排水能力。（ｍ3/時）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 当該施設の排水能力。（ｍ3/時）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ポンプ場施設                             | 現有排水能力                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 汚水揚水量（晴天時最大）（P22a\_026）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ポンプ場施設                             | 現有排水能力                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 汚水揚水量（雨天時最大）（P22a\_027）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ポンプ場施設                             | 現有排水能力                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 雨水揚水量（P22a\_028）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 種類                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 当該施設の種類。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 当該施設の種類。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 処理場施設                               | 種類                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 水処理施設（P22b\_021）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 種類                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 汚泥処理施設（P22b\_022）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 種類                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 有効利用施設（P22b\_023）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 種類                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 再生水利用（P22b\_024）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 放流先河川（P22b\_025）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 当該施設から放流する処理水の放流先河川。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 当該施設から放流する処理水の放流先河川。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 文字列型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 処理場施設                               | 水処理施設処理面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 当該施設における水処理の処理面積。（ha）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 当該施設における水処理の処理面積。（ha）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 処理場施設                               | 水処理施設処理面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 現在（P22b\_026）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 水処理施設処理面積                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 計画（P22b\_027）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 水処理施設処理人口                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 当該施設における水処理の処理人口。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 当該施設における水処理の処理人口。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 処理場施設                               | 水処理施設処理人口                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 現在（P22b\_028）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 水処理施設処理人口                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 計画（P22b\_029）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 水処理施設全体計画区域内人口（P22b\_030）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 当該施設における水処理全体計画区域内の人口。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 当該施設における水処理全体計画区域内の人口。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 整数値                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 水処理施設晴天時1日最大処理量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 当該施設における晴天時1日最大処理量。（ｍ3/日）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 当該施設における晴天時1日最大処理量。（ｍ3/日）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 処理場施設                               | 水処理施設晴天時1日最大処理量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 現在（P22b\_031）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 水処理施設晴天時1日最大処理量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 計画（P22b\_032）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 水処理施設雨天時最大処理量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 当該施設における雨天時1日最大処理量。（ｍ3/日）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 当該施設における雨天時1日最大処理量。（ｍ3/日）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 処理場施設                               | 水処理施設雨天時最大処理量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 現在（P22b\_033）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 処理場施設                               | 水処理施設雨天時最大処理量                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 計画（P22b\_034）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 実数型                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 主な品質情報                             | ■完全性/過剰・漏れ：誤り数0個原典資料と比較。■論理一貫性/書式一貫性・概念一貫性・定義域一貫性：誤率0%XMLスキーマに対する妥当性を検証。                                                                                                                                                                                                                                                                                                                                                                                                                          | ■完全性/過剰・漏れ：誤り数0個原典資料と比較。■論理一貫性/書式一貫性・概念一貫性・定義域一貫性：誤率0%XMLスキーマに対する妥当性を検証。                                                                                                                                                                                                                                                                                                                                                                                                                          | ■完全性/過剰・漏れ：誤り数0個原典資料と比較。■論理一貫性/書式一貫性・概念一貫性・定義域一貫性：誤率0%XMLスキーマに対する妥当性を検証。                                                                                                                                                                                                                                                                                                                                                                                                                          | ■完全性/過剰・漏れ：誤り数0個原典資料と比較。■論理一貫性/書式一貫性・概念一貫性・定義域一貫性：誤率0%XMLスキーマに対する妥当性を検証。                                                                                                                                                                                                                                                                                                                                                                                                                          |
| データフォーマット（符号化）             | JPGISに準拠した符号化（GML形式）。詳細は製品仕様書内の符号化規則を参照してください。SHAPE形式。                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | JPGISに準拠した符号化（GML形式）。詳細は製品仕様書内の符号化規則を参照してください。SHAPE形式。                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | JPGISに準拠した符号化（GML形式）。詳細は製品仕様書内の符号化規則を参照してください。SHAPE形式。                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | JPGISに準拠した符号化（GML形式）。詳細は製品仕様書内の符号化規則を参照してください。SHAPE形式。                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 国土情報ウェブマッピングシステムへの登録 | 登録なし                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 登録なし                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 登録なし                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | NA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 識別子                                   | P22                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | NA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | NA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | NA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| その他の情報                             | ・型が整数・小数である属性において、原典資料が以下の文字列である場合、記述内容を定義しています。 －：-999、不明：-998、震災による不明・記入不能・欠番等：-997・ポンプ場施設・現有排水能力・汚水ポンプ揚水量・晴天時最大において、「96ｍ3/時×２台」のような記述では、総量である「192」を記述しています。・汚水計画項目の「1人1日平均汚水最小、1人1日平均汚水最大、1人1日最大汚水最小、1人1日最大汚水最大」において、290～300等、範囲で示される場合、範囲の最小値を採用しています。・各データのメタデータについては、ダウンロードしたファイルに添付されています。 | ・型が整数・小数である属性において、原典資料が以下の文字列である場合、記述内容を定義しています。 －：-999、不明：-998、震災による不明・記入不能・欠番等：-997・ポンプ場施設・現有排水能力・汚水ポンプ揚水量・晴天時最大において、「96ｍ3/時×２台」のような記述では、総量である「192」を記述しています。・汚水計画項目の「1人1日平均汚水最小、1人1日平均汚水最大、1人1日最大汚水最小、1人1日最大汚水最大」において、290～300等、範囲で示される場合、範囲の最小値を採用しています。・各データのメタデータについては、ダウンロードしたファイルに添付されています。 | ・型が整数・小数である属性において、原典資料が以下の文字列である場合、記述内容を定義しています。 －：-999、不明：-998、震災による不明・記入不能・欠番等：-997・ポンプ場施設・現有排水能力・汚水ポンプ揚水量・晴天時最大において、「96ｍ3/時×２台」のような記述では、総量である「192」を記述しています。・汚水計画項目の「1人1日平均汚水最小、1人1日平均汚水最大、1人1日最大汚水最小、1人1日最大汚水最大」において、290～300等、範囲で示される場合、範囲の最小値を採用しています。・各データのメタデータについては、ダウンロードしたファイルに添付されています。 | ・型が整数・小数である属性において、原典資料が以下の文字列である場合、記述内容を定義しています。 －：-999、不明：-998、震災による不明・記入不能・欠番等：-997・ポンプ場施設・現有排水能力・汚水ポンプ揚水量・晴天時最大において、「96ｍ3/時×２台」のような記述では、総量である「192」を記述しています。・汚水計画項目の「1人1日平均汚水最小、1人1日平均汚水最大、1人1日最大汚水最小、1人1日最大汚水最大」において、290～300等、範囲で示される場合、範囲の最小値を採用しています。・各データのメタデータについては、ダウンロードしたファイルに添付されています。 |

``` r
# 便宜上名前を付ける
colnames(attr_table) <- paste0("c", 1:5)

res <- attr_table %>% 
  tidyr::fill(c3) %>% 
  mutate(
    name = case_when(
      stringr::str_detect(c2, "（P22._[0-9]{3}）") ~ c2,
      stringr::str_detect(c4, "（P22._[0-9]{3}）") ~ paste(c2, c4, sep = "_")
    ),
    description = c3,
    type = c5
  ) %>% 
  filter(!is.na(name)) %>% 
  tidyr::extract(name, into = c("name", "code"), regex = "(.*?)(（[A-Za-z0-9]+._[A-Za-z0-9]+）)") %>% 
  transmute(
    name,
    code = if_else(code != '', stringr::str_remove_all(code, "[（）]"), NA_character_),
    description,
    type
  )
```

`*` を展開する必要がある

``` r
res2 <- res %>%
  rowwise() %>%
  summarise(
    name,
    code = {
      # * を含んでいれば a と b にそれぞれ置き換えた結果を、含んでいなければそのままの結果を
      if (stringr::str_detect(code, stringr::fixed("*"))) {
        stringr::str_replace(code, stringr::fixed("*"), c("a", "b"))
      } else {
        code
      }
    },
    description,
    type
  ) %>% 
  arrange(code)
```

    ## `summarise()` has ungrouped output. You can override using the `.groups` argument.

``` r
knitr::kable(res2)
```

| name                                   | code      | description                                                          | type                             |
|:---------------------------------------|:----------|:---------------------------------------------------------------------|:---------------------------------|
| 行政区域                               | P22a\_001 | 都道府県コードと市区町村コードからなる，行政区を特定するためのコード | コードリスト型（行政区域コード） |
| 施設名称                               | P22a\_002 | 当該施設の名称                                                       | 文字列型                         |
| 所在地                                 | P22a\_003 | 当該施設の所在地。                                                   | 文字列型                         |
| 市町村等団体名                         | P22a\_004 | 当該施設を管理している市町村等団体名。                               | 文字列型                         |
| 事業区分名                             | P22a\_005 | 当該事業の事業区分名。                                               | 列挙型（事業区分名詳細）         |
| 事業名                                 | P22a\_006 | 当該事業の事業名。                                                   | 列挙型（事業区分名詳細）         |
| 全体計画処理面積\_合計                 | P22a\_007 |                                                                      | 実数型                           |
| 全体計画処理面積\_汚水（分流）         | P22a\_008 |                                                                      | 実数型                           |
| 全体計画処理面積\_雨水（分流）         | P22a\_009 |                                                                      | 実数型                           |
| 全体計画処理面積\_合流                 | P22a\_010 |                                                                      | 実数型                           |
| 全体計画計画処理人口                   | P22a\_011 | 当該事業における全体計画の計画処理人口。                             | 整数値                           |
| 全体計画区域内人口                     | P22a\_012 | 当該事業における全体計画の計画区域内人口。                           | 整数値                           |
| 雨水計画\_降雨強度最小                 | P22a\_013 |                                                                      | 実数型                           |
| 雨水計画\_降雨強度最大                 | P22a\_014 |                                                                      | 実数型                           |
| 雨水計画\_確率年最小                   | P22a\_015 |                                                                      | 実数型                           |
| 雨水計画\_確率年最大                   | P22a\_016 |                                                                      | 実数型                           |
| 汚水計画\_1人1日平均汚水最小           | P22a\_017 |                                                                      | 実数型                           |
| 汚水計画\_1人1日平均汚水最大           | P22a\_018 |                                                                      | 実数型                           |
| 汚水計画\_1人1日最大汚水最小           | P22a\_019 |                                                                      | 実数型                           |
| 汚水計画\_1人1日最大汚水次第           | P22a\_020 |                                                                      | 実数型                           |
| 計画排水面積\_汚水                     | P22a\_021 |                                                                      | 実数型                           |
| 計画排水面積\_雨水                     | P22a\_022 |                                                                      | 実数型                           |
| 計画排水量\_汚水（晴天時最大）         | P22a\_023 |                                                                      | 実数型                           |
| 計画排水量\_汚水（雨天時最大）         | P22a\_024 |                                                                      | 実数型                           |
| 計画排水量\_雨水                       | P22a\_025 |                                                                      | 実数型                           |
| 現有排水能力\_汚水揚水量（晴天時最大） | P22a\_026 |                                                                      | 実数型                           |
| 現有排水能力\_汚水揚水量（雨天時最大） | P22a\_027 |                                                                      | 実数型                           |
| 現有排水能力\_雨水揚水量               | P22a\_028 |                                                                      | 実数型                           |
| 行政区域                               | P22b\_001 | 都道府県コードと市区町村コードからなる，行政区を特定するためのコード | コードリスト型（行政区域コード） |
| 施設名称                               | P22b\_002 | 当該施設の名称                                                       | 文字列型                         |
| 所在地                                 | P22b\_003 | 当該施設の所在地。                                                   | 文字列型                         |
| 市町村等団体名                         | P22b\_004 | 当該施設を管理している市町村等団体名。                               | 文字列型                         |
| 事業区分名                             | P22b\_005 | 当該事業の事業区分名。                                               | 列挙型（事業区分名詳細）         |
| 事業名                                 | P22b\_006 | 当該事業の事業名。                                                   | 列挙型（事業区分名詳細）         |
| 全体計画処理面積\_合計                 | P22b\_007 |                                                                      | 実数型                           |
| 全体計画処理面積\_汚水（分流）         | P22b\_008 |                                                                      | 実数型                           |
| 全体計画処理面積\_雨水（分流）         | P22b\_009 |                                                                      | 実数型                           |
| 全体計画処理面積\_合流                 | P22b\_010 |                                                                      | 実数型                           |
| 全体計画計画処理人口                   | P22b\_011 | 当該事業における全体計画の計画処理人口。                             | 整数値                           |
| 全体計画区域内人口                     | P22b\_012 | 当該事業における全体計画の計画区域内人口。                           | 整数値                           |
| 雨水計画\_降雨強度最小                 | P22b\_013 |                                                                      | 実数型                           |
| 雨水計画\_降雨強度最大                 | P22b\_014 |                                                                      | 実数型                           |
| 雨水計画\_確率年最小                   | P22b\_015 |                                                                      | 実数型                           |
| 雨水計画\_確率年最大                   | P22b\_016 |                                                                      | 実数型                           |
| 汚水計画\_1人1日平均汚水最小           | P22b\_017 |                                                                      | 実数型                           |
| 汚水計画\_1人1日平均汚水最大           | P22b\_018 |                                                                      | 実数型                           |
| 汚水計画\_1人1日最大汚水最小           | P22b\_019 |                                                                      | 実数型                           |
| 汚水計画\_1人1日最大汚水次第           | P22b\_020 |                                                                      | 実数型                           |
| 種類\_水処理施設                       | P22b\_021 |                                                                      | 実数型                           |
| 種類\_汚泥処理施設                     | P22b\_022 |                                                                      | 実数型                           |
| 種類\_有効利用施設                     | P22b\_023 |                                                                      | 実数型                           |
| 種類\_再生水利用                       | P22b\_024 |                                                                      | 実数型                           |
| 放流先河川                             | P22b\_025 | 当該施設から放流する処理水の放流先河川。                             | 文字列型                         |
| 水処理施設処理面積\_現在               | P22b\_026 |                                                                      | 実数型                           |
| 水処理施設処理面積\_計画               | P22b\_027 |                                                                      | 実数型                           |
| 水処理施設処理人口\_現在               | P22b\_028 |                                                                      | 実数型                           |
| 水処理施設処理人口\_計画               | P22b\_029 |                                                                      | 実数型                           |
| 水処理施設全体計画区域内人口           | P22b\_030 | 当該施設における水処理全体計画区域内の人口。                         | 整数値                           |
| 水処理施設晴天時1日最大処理量\_現在    | P22b\_031 |                                                                      | 実数型                           |
| 水処理施設晴天時1日最大処理量\_計画    | P22b\_032 |                                                                      | 実数型                           |
| 水処理施設雨天時最大処理量\_現在       | P22b\_033 |                                                                      | 実数型                           |
| 水処理施設雨天時最大処理量\_計画       | P22b\_034 |                                                                      | 実数型                           |

``` r
res2 %>% 
  readr::write_csv(output)
```
