Extract data from L05
================

``` r
library(rvest)
library(dplyr, warn.conflicts = FALSE)

dir.create(here::here("data", "attrs"), recursive = TRUE, showWarnings = FALSE)
```

### `L05`

``` r
input <- here::here("data-raw", "datalist", "KsjTmplt-L05.html")
id <- stringr::str_replace(basename(input), "(?:KsjTmplt-)(.*?)(?:-v.*)?(?:\\.html)", "\\1")
output <- here::here("data", "attrs", glue::glue("{id}.csv"))

attr_table <- read_html(input) %>% 
  html_table(convert = FALSE) %>% 
  purrr::keep(~ "地物情報" %in% colnames(.x))

stopifnot(length(attr_table) == 1)
attr_table <- attr_table[[1]]

knitr::kable(attr_table)
```

| 地物情報                                 | 地物名                                                                                                                                                                                                                                                                                  | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 形状                                                                                                                                                                                                                                                                                    |
|:-----------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 地物情報                                 | 工業用地                                                                                                                                                                                                                                                                                | 工業団地開発による敷地面積10ha 以上の用地（工業団地）と単独立地による敷地面積10ha以上の用地（単独工場用地）の範囲の広がり                                                                                                                                                               | 工業団地開発による敷地面積10ha 以上の用地（工業団地）と単独立地による敷地面積10ha以上の用地（単独工場用地）の範囲の広がり                                                                                                                                                               | 工業団地開発による敷地面積10ha 以上の用地（工業団地）と単独立地による敷地面積10ha以上の用地（単独工場用地）の範囲の広がり                                                                                                                                                               | 曲面型（GM\_Surface）                                                                                                                                                                                                                                                                   |
| 属性情報                                 | 属性名                                                                                                                                                                                                                                                                                  | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 属性の型                                                                                                                                                                                                                                                                                |
| 属性情報                                 | 工業用地ID（L01\_001）                                                                                                                                                                                                                                                                  | 工業用地の識別番号都道府県コード＋用地番号＋地区番号の7桁の番号                                                                                                                                                                                                                         | 工業用地の識別番号都道府県コード＋用地番号＋地区番号の7桁の番号                                                                                                                                                                                                                         | 工業用地の識別番号都道府県コード＋用地番号＋地区番号の7桁の番号                                                                                                                                                                                                                         | 整数型（Integer）                                                                                                                                                                                                                                                                       |
| 属性情報                                 | 工業用地名（L01\_002）                                                                                                                                                                                                                                                                  | 工業団地名または単独工場の名称                                                                                                                                                                                                                                                          | 工業団地名または単独工場の名称                                                                                                                                                                                                                                                          | 工業団地名または単独工場の名称                                                                                                                                                                                                                                                          | 文字列型（CharacterString）                                                                                                                                                                                                                                                             |
| 属性情報                                 | 行政コード（L01\_003）                                                                                                                                                                                                                                                                  | 都道府県コードと市区町村コードからなる，行政区を特定するためのコードJIS 規格（JIS X 0401，JIS X 0402）準拠                                                                                                                                                                              | 都道府県コードと市区町村コードからなる，行政区を特定するためのコードJIS 規格（JIS X 0401，JIS X 0402）準拠                                                                                                                                                                              | 都道府県コードと市区町村コードからなる，行政区を特定するためのコードJIS 規格（JIS X 0401，JIS X 0402）準拠                                                                                                                                                                              | コードリスト「行政コード」                                                                                                                                                                                                                                                              |
| 属性情報                                 | 市区町村名（L01\_004）                                                                                                                                                                                                                                                                  | 当該単独工場用地が属する市区町村名                                                                                                                                                                                                                                                      | 当該単独工場用地が属する市区町村名                                                                                                                                                                                                                                                      | 当該単独工場用地が属する市区町村名                                                                                                                                                                                                                                                      | 文字列型（CharacterString）                                                                                                                                                                                                                                                             |
| 属性情報                                 | 臨海・内陸区分コード（L01\_005）                                                                                                                                                                                                                                                        | 当該単独工場用地が存在する位置の番号1：臨海　2：内陸                                                                                                                                                                                                                                    | 当該単独工場用地が存在する位置の番号1：臨海　2：内陸                                                                                                                                                                                                                                    | 当該単独工場用地が存在する位置の番号1：臨海　2：内陸                                                                                                                                                                                                                                    | コードリスト「臨海・内陸区分コード」                                                                                                                                                                                                                                                    |
| 属性情報                                 | 特記事項（L01\_006）                                                                                                                                                                                                                                                                    | 当該工業団地についての開発経緯や特色など、特別な事項を記載                                                                                                                                                                                                                              | 当該工業団地についての開発経緯や特色など、特別な事項を記載                                                                                                                                                                                                                              | 当該工業団地についての開発経緯や特色など、特別な事項を記載                                                                                                                                                                                                                              | 文字列型（CharacterString）                                                                                                                                                                                                                                                             |
| 地物情報                                 | 地物名                                                                                                                                                                                                                                                                                  | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    |
| 地物情報                                 | 工業団地                                                                                                                                                                                                                                                                                | 工業団地開発による敷地面積10ha以上の用地の範囲                                                                                                                                                                                                                                          | 工業団地開発による敷地面積10ha以上の用地の範囲                                                                                                                                                                                                                                          | 工業団地開発による敷地面積10ha以上の用地の範囲                                                                                                                                                                                                                                          | 工業団地開発による敷地面積10ha以上の用地の範囲                                                                                                                                                                                                                                          |
| 属性情報                                 | 属性名                                                                                                                                                                                                                                                                                  | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 属性の型                                                                                                                                                                                                                                                                                |
| 属性情報                                 | 事業主体名（L01\_007）                                                                                                                                                                                                                                                                  | 当該工業団地の開発事業主体名                                                                                                                                                                                                                                                            | 当該工業団地の開発事業主体名                                                                                                                                                                                                                                                            | 当該工業団地の開発事業主体名                                                                                                                                                                                                                                                            | 文字列型（CharacterString）                                                                                                                                                                                                                                                             |
| 属性情報                                 | 事業完了年（L01\_008）                                                                                                                                                                                                                                                                  | 当該工業団地開発の事業完了年もしくは完了予定年                                                                                                                                                                                                                                          | 当該工業団地開発の事業完了年もしくは完了予定年                                                                                                                                                                                                                                          | 当該工業団地開発の事業完了年もしくは完了予定年                                                                                                                                                                                                                                          | 時間型（TM\_Instant）                                                                                                                                                                                                                                                                   |
| 属性情報                                 | 全体開発面積（L01\_009）                                                                                                                                                                                                                                                                | 当該工業団地全体の面積（ha）                                                                                                                                                                                                                                                            | 当該工業団地全体の面積（ha）                                                                                                                                                                                                                                                            | 当該工業団地全体の面積（ha）                                                                                                                                                                                                                                                            | 実数型（Real）                                                                                                                                                                                                                                                                          |
| 属性情報                                 | 工業用地面積（L01\_010）                                                                                                                                                                                                                                                                | 当該工業団地における工業用地の面積（ha）                                                                                                                                                                                                                                                | 当該工業団地における工業用地の面積（ha）                                                                                                                                                                                                                                                | 当該工業団地における工業用地の面積（ha）                                                                                                                                                                                                                                                | 実数型（Real）                                                                                                                                                                                                                                                                          |
| 属性情報                                 | 未利用面積（L01\_011）                                                                                                                                                                                                                                                                  | 当該工業団地における未利用地の面積（ha）                                                                                                                                                                                                                                                | 当該工業団地における未利用地の面積（ha）                                                                                                                                                                                                                                                | 当該工業団地における未利用地の面積（ha）                                                                                                                                                                                                                                                | 実数型（Real）                                                                                                                                                                                                                                                                          |
| 属性情報                                 | 用途地域コード（L01\_013）                                                                                                                                                                                                                                                              | 当該工業団地に指定されている用途地域応じたコード                                                                                                                                                                                                                                        | 当該工業団地に指定されている用途地域応じたコード                                                                                                                                                                                                                                        | 当該工業団地に指定されている用途地域応じたコード                                                                                                                                                                                                                                        | コードリスト「用途地域コード」                                                                                                                                                                                                                                                          |
| 属性情報                                 | 立地企業数（L01\_014）                                                                                                                                                                                                                                                                  | 当該工業団地に立地する企業数                                                                                                                                                                                                                                                            | 当該工業団地に立地する企業数                                                                                                                                                                                                                                                            | 当該工業団地に立地する企業数                                                                                                                                                                                                                                                            | 整数型（Integer）                                                                                                                                                                                                                                                                       |
| 属性情報                                 | 立地企業名1～10（L01\_015）                                                                                                                                                                                                                                                             | 当該工業団地に立地する企業名及び組合名                                                                                                                                                                                                                                                  | 当該工業団地に立地する企業名及び組合名                                                                                                                                                                                                                                                  | 当該工業団地に立地する企業名及び組合名                                                                                                                                                                                                                                                  | 文字列型（CharacterString）                                                                                                                                                                                                                                                             |
| 地物情報                                 | 地物名                                                                                                                                                                                                                                                                                  | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    |
| 地物情報                                 | 単独工業用地                                                                                                                                                                                                                                                                            | 単独立地による敷地面積10ha以上の用地の範囲                                                                                                                                                                                                                                              | 単独立地による敷地面積10ha以上の用地の範囲                                                                                                                                                                                                                                              | 単独立地による敷地面積10ha以上の用地の範囲                                                                                                                                                                                                                                              | 単独立地による敷地面積10ha以上の用地の範囲                                                                                                                                                                                                                                              |
| 属性情報                                 | 地物名                                                                                                                                                                                                                                                                                  | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 説明                                                                                                                                                                                                                                                                                    | 属性の型                                                                                                                                                                                                                                                                                |
| 属性情報                                 | 業種（L01\_016）                                                                                                                                                                                                                                                                        | 当該単独工場用地に立地する企業の主な業種                                                                                                                                                                                                                                                | 当該単独工場用地に立地する企業の主な業種                                                                                                                                                                                                                                                | 当該単独工場用地に立地する企業の主な業種                                                                                                                                                                                                                                                | 文字列型（CharacterString）                                                                                                                                                                                                                                                             |
| 主な品質情報                             | ■ 完全性/過剰・漏れ：全数検査　過剰・漏れデータ数0個■ 論理一貫性/書式一貫性・概念一貫性・定義域一貫性：全数検査　誤率0%■ 位置正確度/絶対正確度：全数検査　図上 5mm（実寸 250m）以内■ 時間正確度/時間測定正確度：全数検査　誤率0%■ 主題正確度/非定量的主題属性の正しさ：全数検査　誤率0% | ■ 完全性/過剰・漏れ：全数検査　過剰・漏れデータ数0個■ 論理一貫性/書式一貫性・概念一貫性・定義域一貫性：全数検査　誤率0%■ 位置正確度/絶対正確度：全数検査　図上 5mm（実寸 250m）以内■ 時間正確度/時間測定正確度：全数検査　誤率0%■ 主題正確度/非定量的主題属性の正しさ：全数検査　誤率0% | ■ 完全性/過剰・漏れ：全数検査　過剰・漏れデータ数0個■ 論理一貫性/書式一貫性・概念一貫性・定義域一貫性：全数検査　誤率0%■ 位置正確度/絶対正確度：全数検査　図上 5mm（実寸 250m）以内■ 時間正確度/時間測定正確度：全数検査　誤率0%■ 主題正確度/非定量的主題属性の正しさ：全数検査　誤率0% | ■ 完全性/過剰・漏れ：全数検査　過剰・漏れデータ数0個■ 論理一貫性/書式一貫性・概念一貫性・定義域一貫性：全数検査　誤率0%■ 位置正確度/絶対正確度：全数検査　図上 5mm（実寸 250m）以内■ 時間正確度/時間測定正確度：全数検査　誤率0%■ 主題正確度/非定量的主題属性の正しさ：全数検査　誤率0% | ■ 完全性/過剰・漏れ：全数検査　過剰・漏れデータ数0個■ 論理一貫性/書式一貫性・概念一貫性・定義域一貫性：全数検査　誤率0%■ 位置正確度/絶対正確度：全数検査　図上 5mm（実寸 250m）以内■ 時間正確度/時間測定正確度：全数検査　誤率0%■ 主題正確度/非定量的主題属性の正しさ：全数検査　誤率0% |
| データフォーマット（符号化）             | ・GML形式（JPGIS2.1準拠）。詳細は製品仕様書内の符号化規則を参照してください。・シェープファイル形式。シェープファイルの属性について                                                                                                                                                     | ・GML形式（JPGIS2.1準拠）。詳細は製品仕様書内の符号化規則を参照してください。・シェープファイル形式。シェープファイルの属性について                                                                                                                                                     | ・GML形式（JPGIS2.1準拠）。詳細は製品仕様書内の符号化規則を参照してください。・シェープファイル形式。シェープファイルの属性について                                                                                                                                                     | ・GML形式（JPGIS2.1準拠）。詳細は製品仕様書内の符号化規則を参照してください。・シェープファイル形式。シェープファイルの属性について                                                                                                                                                     | ・GML形式（JPGIS2.1準拠）。詳細は製品仕様書内の符号化規則を参照してください。・シェープファイル形式。シェープファイルの属性について                                                                                                                                                     |
| 国土情報ウェブマッピングシステムへの登録 | 登録なし                                                                                                                                                                                                                                                                                | 登録なし                                                                                                                                                                                                                                                                                | 登録なし                                                                                                                                                                                                                                                                                | 登録なし                                                                                                                                                                                                                                                                                | 登録なし                                                                                                                                                                                                                                                                                |
| 識別子                                   | L05-1, L05-2                                                                                                                                                                                                                                                                            | L05-1, L05-2                                                                                                                                                                                                                                                                            | L05-1, L05-2                                                                                                                                                                                                                                                                            | L05-1, L05-2                                                                                                                                                                                                                                                                            | L05-1, L05-2                                                                                                                                                                                                                                                                            |
| その他の情報                             | 各データのメタデータについては、ダウンロードしたファイルに添付されています。                                                                                                                                                                                                            | 各データのメタデータについては、ダウンロードしたファイルに添付されています。                                                                                                                                                                                                            | 各データのメタデータについては、ダウンロードしたファイルに添付されています。                                                                                                                                                                                                            | 各データのメタデータについては、ダウンロードしたファイルに添付されています。                                                                                                                                                                                                            | 各データのメタデータについては、ダウンロードしたファイルに添付されています。                                                                                                                                                                                                            |

どうやら3〜5は完全に同じっぽいので、どれか1列だけでいい。

``` r
all.equal(attr_table[[3]], attr_table[[4]])
```

    ## [1] TRUE

``` r
all.equal(attr_table[[3]], attr_table[[5]])
```

    ## [1] TRUE

``` r
attr_table <- attr_table[, -(4:5)]
```

``` r
attr_table <- attr_table %>% 
  # テーブルが複数回出てくるのでそれは除外する
  filter(地物情報 == "属性情報", !地物名 %in% c("属性名", "地物名"))

colnames(attr_table) <- c("_", "name", "description", "type")

res <- attr_table %>%
  tidyr::extract(name, into = c("name", "code"), regex = "([^（]*)(（.*）)?") %>% 
  transmute(
    name,
    code = if_else(code != '', stringr::str_remove_all(code, "[（）]"), NA_character_),
    description,
    type
  )
```

どうやら`code`を間違えているらしいので修正する…

``` r
knitr::kable(res)
```

| name                 | code     | description                                                                                                | type                                 |
|:---------------------|:---------|:-----------------------------------------------------------------------------------------------------------|:-------------------------------------|
| 工業用地ID           | L01\_001 | 工業用地の識別番号都道府県コード＋用地番号＋地区番号の7桁の番号                                            | 整数型（Integer）                    |
| 工業用地名           | L01\_002 | 工業団地名または単独工場の名称                                                                             | 文字列型（CharacterString）          |
| 行政コード           | L01\_003 | 都道府県コードと市区町村コードからなる，行政区を特定するためのコードJIS 規格（JIS X 0401，JIS X 0402）準拠 | コードリスト「行政コード」           |
| 市区町村名           | L01\_004 | 当該単独工場用地が属する市区町村名                                                                         | 文字列型（CharacterString）          |
| 臨海・内陸区分コード | L01\_005 | 当該単独工場用地が存在する位置の番号1：臨海　2：内陸                                                       | コードリスト「臨海・内陸区分コード」 |
| 特記事項             | L01\_006 | 当該工業団地についての開発経緯や特色など、特別な事項を記載                                                 | 文字列型（CharacterString）          |
| 事業主体名           | L01\_007 | 当該工業団地の開発事業主体名                                                                               | 文字列型（CharacterString）          |
| 事業完了年           | L01\_008 | 当該工業団地開発の事業完了年もしくは完了予定年                                                             | 時間型（TM\_Instant）                |
| 全体開発面積         | L01\_009 | 当該工業団地全体の面積（ha）                                                                               | 実数型（Real）                       |
| 工業用地面積         | L01\_010 | 当該工業団地における工業用地の面積（ha）                                                                   | 実数型（Real）                       |
| 未利用面積           | L01\_011 | 当該工業団地における未利用地の面積（ha）                                                                   | 実数型（Real）                       |
| 用途地域コード       | L01\_013 | 当該工業団地に指定されている用途地域応じたコード                                                           | コードリスト「用途地域コード」       |
| 立地企業数           | L01\_014 | 当該工業団地に立地する企業数                                                                               | 整数型（Integer）                    |
| 立地企業名1～10      | L01\_015 | 当該工業団地に立地する企業名及び組合名                                                                     | 文字列型（CharacterString）          |
| 業種                 | L01\_016 | 当該単独工場用地に立地する企業の主な業種                                                                   | 文字列型（CharacterString）          |

``` r
res %>% 
  mutate(code = stringr::str_replace(code, "L01", "L05")) %>% 
  readr::write_csv(output)
```
